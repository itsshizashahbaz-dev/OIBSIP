/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import{analytics as e,events as a}from"../../common/analytics.js";import{dcLocalStorage as t}from"../../common/local-storage.js";import{util as r}from"../util.js";import{floodgate as n}from"../floodgate.js";import{removeExperimentCodeForAnalytics as s,setExperimentCodeForAnalytics as o}from"../../common/experimentUtils.js";const c={"whatsapp-preview":{featureFlag:"dc-cv-express-whatsapp-preview",enabledPropertyName:"enableWhatsappPreviewExpressMenu",cleanup:!0},"whatsapp-hover":{featureFlag:"dc-cv-express-whatsapp-hover",controlFlag:"dc-cv-express-whatsapp-hover-control",enabledPropertyName:"enableWhatsappHoverExpressMenu",enabledLocales:["en-US","en-GB"],analyticsEnabledEvent:a.EXPRESS_WHATSAPP_HOVER_MENU_FG_ENABLED,analyticsControlEvent:a.EXPRESS_WHATSAPP_HOVER_MENU_FG_CONTROL_ENABLED,cleanup:!1},"gmail-native-viewer":{featureFlag:"dc-cv-express-gmail-native-viewer",enabledPropertyName:"enableGmailNVExpressMenu",cleanup:!0},"gmail-message-view":{featureFlag:"dc-cv-express-gmail-message-view",controlFlag:"dc-cv-express-gmail-message-view-control",enabledPropertyName:"enableGmailMessageViewCTA",enabledLocales:["en-US","en-GB"],analyticsEnabledEvent:a.EXPRESS_GMAIL_MESSAGE_VIEW_FG_ENABLED,analyticsControlEvent:a.EXPRESS_GMAIL_MESSAGE_VIEW_FG_CONTROL_ENABLED,cleanup:!1},"google-image-preview":{featureFlag:"dc-cv-express-google-image-preview",enabledPropertyName:"enableGoogleImagePreviewExpressMenu",cleanup:!0},"gdrive-native-viewer":{featureFlag:"dc-cv-express-gdrive-native-viewer",enabledPropertyName:"enableGdriveNativeViewerExpressMenu",cleanup:!0},"facebook-preview":{featureFlag:"dc-cv-express-facebook-preview",enabledPropertyName:"enableFacebookPreviewExpressMenu",cleanup:!0},"chatgpt-preview":{featureFlag:"dc-cv-express-chatgpt-preview",controlFlag:"dc-cv-express-chatgpt-preview-control",enabledPropertyName:"enableChatGPTPreviewExpressMenu",enabledLocales:["en-US","en-GB"],analyticsEnabledEvent:a.EXPRESS_CHATGPT_PREVIEW_FG_ENABLED,analyticsControlEvent:a.EXPRESS_CHATGPT_PREVIEW_FG_CONTROL_ENABLED,cleanup:!1}};function l(e){const a="facebook-preview"===e?"facebook":e;return{analyticsEnabledKey:`express-${a}-fg-enabled-analytics-logged`,analyticsControlKey:`express-${a}-fg-control-enabled-analytics-logged`}}function i(){const e="true"===t.getItem("adobeInternal"),a=t.getItem("installSource");return e||"admin"!==a}async function p(){const e={"dc-cv-express-standalone":"EL","dc-cv-express-standalone-control":"ELC","dc-cv-express-whatsapp-hover":"EWH","dc-cv-express-whatsapp-hover-control":"EWHC","dc-cv-express-gmail-message-view":"EGM","dc-cv-express-gmail-message-view-control":"EGMC","dc-cv-express-google-image-preview-fte":"EIF","dc-cv-express-google-image-preview-fte-control":"EIFC","dc-cv-express-gdrive-native-viewer-fte":"EDF","dc-cv-express-gdrive-native-viewer-fte-control":"EDFC","dc-cv-express-chatgpt-preview":"ECP","dc-cv-express-chatgpt-preview-control":"ECPC"},a=i();for(const t of Object.keys(e)){const r=e[t];a&&await n.hasFlag(t)&&E(t)?o(r):s(r)}s("Exp_Mod"),s("Exp_Loe"),s("EC"),s("EWP"),s("EWPC"),s("EGN"),s("EGNC"),s("ECS"),s("ECSC"),s("EI2"),s("EI2C"),s("EGI"),s("EGIC"),s("EWSC"),s("EWS"),s("EWF"),s("EWFC"),s("EGF"),s("EGFC"),s("EGD"),s("EGDC"),s("EFB"),s("EFBC")}function E(e){const a=r.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale")),t={};for(const[e,a]of Object.entries(c))a.featureFlag&&(t[a.featureFlag]=e),a.controlFlag&&(t[a.controlFlag]=e);const n=t[e];return!n||!c[n]?.enabledLocales||c[n].enabledLocales.includes(a)}async function v(a){const s=c[a];if(!s)throw new Error(`Unknown surface: ${a}`);const{featureFlag:o,controlFlag:E,enabledPropertyName:v,enabledLocales:g,analyticsEnabledEvent:d,analyticsControlEvent:m,cleanup:u=!1}=s,{analyticsEnabledKey:w,analyticsControlKey:f}=l(a)||{},b={[v]:!1,enableExpressOptionsPagePreference:!1};if(g){const e=r.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale"));if(!g.includes(e))return b}const x=await n.hasFlag(o),F=!!E&&await n.hasFlag(E);let P=t.getItem("express-touch-points");return P=""===P||P,await p(),i()&&(x&&w&&d&&"true"!==t.getItem(w)&&(t.setItem(w,"true"),e.event(d)),F&&f&&m&&"true"!==t.getItem(f)&&(t.setItem(f,"true"),e.event(m))),x&&i()&&(b.enableExpressOptionsPagePreference=!0,P&&"false"!==P&&(b[v]=!0)),u&&(t.removeItem(w),t.removeItem(f)),b}export{v as isExpressMenuEnabled,i as isExpressEnabledForInstallType,p as setFeatureVariantForAnalytics,l as deriveAnalyticsKeys};