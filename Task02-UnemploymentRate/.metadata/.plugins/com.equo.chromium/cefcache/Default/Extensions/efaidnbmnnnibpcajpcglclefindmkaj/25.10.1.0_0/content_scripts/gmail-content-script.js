/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="acrobatContentScriptDisconnectStart",t="acrobatContentScriptDisconnectEnd",o="acrobat-gmail-fte-config";let i,n,r,s,c,a,m,l,p,u,g,d,h,v,w,f,b,T;const P=()=>{v&&(r?.addAcrobatTouchPointInTheMessageView(),s?.processForListView(),n?.processForAlreadyShownNativeViewerPrompt()),w&&l?.addExpressNativeViewerTouchpoint(),f&&p?.addExpressMessageViewTouchpoint(),b?(d?.addTouchpointToNativeViewerViaMessageView(),u?.addTouchpointToNativeViewerViaListView(),g?.processForAlreadyShownNativeViewerTouchpoint()):T&&g?.processForNativeViewerControlExperiment()},L=new MutationObserver(function(){h?.disconnectBodyObserver?L.disconnect():(L.takeRecords(),chrome?.runtime?.id?P():(a?.removeAllAcrobatTouchPoints(),l?.removeExpressTouchpoints(),g?.removeAllAcrobatNonPdfTouchPoints(),L?.disconnect()))}),_=()=>{if(document?.body)try{const e={childList:!0,subtree:!0};L.observe(document.body,e)}catch(e){}else setTimeout(_,500)},C=()=>{window.addEventListener(t,e=>h.contentScriptDisconnectEnd(e),{signal:h?.eventControllerSignal}),window.addEventListener(e,()=>(e=>{if(!chrome.runtime?.id){const o=e.createStateToTransferToNewContentScript();e.contentScriptDisconnectStart(),L?.disconnect(),window.dispatchEvent(new CustomEvent(t,{detail:{state:o}}))}})(h),{signal:h?.eventControllerSignal})},D=()=>{C(),window.dispatchEvent(new Event("orphanContentScript")),window.dispatchEvent(new CustomEvent(e)),c.addFontToDocument(h)},E=(e,t,n)=>{var r;h&&(h.gmailConfig=e,h.iconURL="browser/images/acrobat_dc_appicon_128.png",h.iconURLListView="browser/images/acrobat_dc_trefoil_24_white.svg",h.viewerURLPrefix=chrome.runtime.getURL("viewer.html"),h.expressConfig=t,h.gmailConvertToPdfConfig=n),v&&(D(),i&&i.init(),(async()=>{const e=(new Date).getTime();let t={count:0,nextDate:e};t=(await chrome.storage.local.get(o))?.[o]||t;const i=h?.gmailConfig?.fteConfig?.tooltip;((e,t)=>-1!==e?.resetDay&&t>e?.resetDay)(i,e)&&(t.count=0,t.nextDate=e),h.fteToolTip={eligibleFte:{type:""},...t},t={[o]:t},chrome.storage.local.set(t)})(),r=e,h.isAcrobatDefaultForGmailPDFs=r?.isAcrobatDefaultForSurface),!v&&b&&(D(),i&&i.init())};chrome.runtime.onMessage.addListener(function(e){"acrobatGmailFteStateUpdated"===e.content_op?h.fteToolTip={...h.fteToolTip,...e?.fteState}:"changeDefaultViewershipForSurface"===e.content_op?"gmail"===e?.surfaceId&&chrome.runtime.id&&(e?.isDefault?m?.takeDefaultViewerShip():m?.resetDefaultViewership(),C(),P()):"acrobatTouchPointsDisabled"===e.content_op&&(h.gmailConfig.touchPointSettingEnabled=!1,h?.isAcrobatDefaultForGmailPDFs||(v=!1,a?.removeAllAcrobatTouchPoints()),b=!1,g?.removeAllAcrobatNonPdfTouchPoints(),h?.disconnectAcrobatListeners())}),(async()=>{const e=chrome.runtime.getURL("content_scripts/gmail/state.js"),t=chrome.runtime.getURL("content_scripts/gmail/gmail-response-service.js"),o=chrome.runtime.getURL("content_scripts/gmail/native-viewer-touch-point-service.js"),v=chrome.runtime.getURL("content_scripts/gmail/message-view-touch-point-service.js"),w=chrome.runtime.getURL("content_scripts/gmail/list-view-touch-point-service.js"),f=chrome.runtime.getURL("content_scripts/utils/util.js"),b=chrome.runtime.getURL("content_scripts/gmail/util.js"),T=chrome.runtime.getURL("content_scripts/gmail/default-viewership-service.js"),P=chrome.runtime.getURL("content_scripts/express/gmail/express-gmail-touchpoint-service.js"),L=chrome.runtime.getURL("content_scripts/express/gmail/express-gmail-message-view-touchpoint-service.js"),_=chrome.runtime.getURL("content_scripts/gmail/gmail-verb-message-view.js"),C=chrome.runtime.getURL("content_scripts/gmail/gmail-verb-list-view.js"),D=chrome.runtime.getURL("content_scripts/gmail/gmail-verb-native-viewer.js");return Promise.all([import(t),import(o),import(v),import(w),import(b),import(f),import(T),import(e),import(P),import(L),import(_),import(C),import(D)]).then(e=>{i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],c=e[5],m=e[6],h=e[7]?.default,l=e[8],p=e[9],d=e[10],u=e[11],g=e[12]})})().then(()=>{window.location?.search?.includes("acrobatPromotionSource")||Promise.all([chrome.runtime.sendMessage({main_op:"gmail-init"}),chrome.runtime.sendMessage({main_op:"gmail-express-init"}),chrome.runtime.sendMessage({main_op:"gmail-convert-to-pdf-init"})]).then(([e,t,o])=>{v=(e=>a?.shouldProcessForListView(e))(e),w=function(e){return e.enableGmailNVExpressMenu}(t),f=function(e){return e.enableGmailMessageViewCTA}(t),b=function(e,t){return a?.shouldProcessForConvertToPDF(e,t)}(o,e),T=function(e){return e?.enableConvertToPdfTouchpointInGmailControl}(o),(v||w||f||b||T)&&(E(e,t,o),a?.removeAllAcrobatTouchPoints(),l?.removeExpressTouchpoints(),g?.removeAllAcrobatNonPdfTouchPoints(),P(),_(),v&&(c?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:PromotionFeature:Enable"),c?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:FTE:Enable")),(b||T)&&c?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:ConvertToPdf:Enable"))})})})();