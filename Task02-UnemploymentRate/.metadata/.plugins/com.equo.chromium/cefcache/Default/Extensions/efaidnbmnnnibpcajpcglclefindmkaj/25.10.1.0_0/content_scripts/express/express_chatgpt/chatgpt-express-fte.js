/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
class ChatGPTExpressFte{id="ChatGPTExpressFte";timeout=3e3;rendered=!1;maxFteCount=3;fteGapBetweenIterations=6048e5;chatgptExpressStateKey="chatgptExpressState";chatgptExpressInitialState={previewTouchpointUsed:!1,chatViewTouchpointUsed:!1,webImagesPreviewTouchpointUsed:!1,fte:{shown:0,lastShown:null}};constructor(t){this.config=t,this.initPromise=this.init()}isChatGPTDomain=()=>window.location.hostname.includes("chatgpt.com");init=async()=>{const t=await chrome.runtime.sendMessage({main_op:"chatgpt-express-init"});if(!this.isChatGPTDomain())return this.isEligible=async()=>!1,void(this.render=async()=>{});this.config=t,await this.loadContentScripts()};loadContentScripts=async()=>{const t=chrome.runtime.getURL("content_scripts/express/fte/express-contextual-fte.js");return Promise.all([import(t)]).then(t=>{this.expressContextualFteClass=t[0].default})};updateChatGPTExpressState=async()=>{let t=await chrome.storage.local.get(this.chatgptExpressStateKey);t=t?.chatgptExpressState?t.chatgptExpressState:this.chatgptExpressInitialState,t.fte||(t.fte={shown:0,lastShown:null}),t.fte.shown=(t.fte.shown||0)+1,t.fte.lastShown=Date.now(),chrome.storage.local.set({[this.chatgptExpressStateKey]:t})};isEligible=async()=>{if(await this.initPromise,this.rendered)return!1;if(!this.config?.enableChatGPTExpressFte)return!1;let t=await chrome.storage.local.get(this.chatgptExpressStateKey);if(t?.chatgptExpressState?t=t.chatgptExpressState:(t=this.chatgptExpressInitialState,chrome.storage.local.set({[this.chatgptExpressStateKey]:t})),t.previewTouchpointUsed||t.chatViewTouchpointUsed||t.webImagesPreviewTouchpointUsed)return!1;if(t.fte?.shown>=this.maxFteCount)return!1;if(t.fte?.lastShown&&t.fte?.lastShown+this.fteGapBetweenIterations>Date.now())return!1;return!!await this.getCtaElement()};_renderFte=t=>{this.ctaButtonWrapper?.appendChild(t)};_positionFte=(t,e)=>{const s=e.getBoundingClientRect(),i=t.getElementsByClassName("ae1eed7c-express-contextual-fte")?.[0];i&&(this.ctaButtonWrapper.classList.contains("chatgptWebImagesPreviewGreyBackground")?(i.style.top=e.offsetHeight+window.scrollY+"px",i.style.left=e.offsetWidth/2+window.scrollX+"px"):(i.style.top=s.top+e.offsetHeight+window.scrollY+"px",i.style.left=s.left+e.offsetWidth/2+window.scrollX+"px"),i.style.transform="translate(-50%, 0%)")};render=async()=>{if(this.rendered)return;if(this.ctaButtonWrapper=await this.getCtaElement(),!this.ctaButtonWrapper)return;const t=this.ctaButtonWrapper?.getElementsByClassName("cc440d50ba-express-entrypoint-button")[0];t&&(this.rendered=!0,this.expressContextualFTE=new this.expressContextualFteClass({touchpoint:"chatgptPreview",ctaButtonElement:this.ctaButtonWrapper,fteStrings:{fteTitle:this.config.fteStrings?.title||"Edit images with Adobe Express",fteDescription:this.config.fteStrings?.description||"Click to enhance your images with professional editing tools",fteCtaLabel:this.config.fteStrings?.ctaLabel||"Got it"},updateFteStateCallback:this.updateChatGPTExpressState,positionFteCallback:this._positionFte,renderCallback:this._renderFte}),await this.expressContextualFTE.render())};getCtaElement=async()=>{const t=["chatgpt-preview-adobe-express-entry-point","chatgpt-webimagespreview-adobe-express-entry-point"];for(let e=0;e<10;e++){for(const e of t){const t=document.getElementById(e);if(t)return t}await new Promise(t=>setTimeout(t,100))}return null};remove=()=>{this.expressContextualFTE&&(this.expressContextualFTE.remove(),this.rendered=!1)}}